import { ChatMessage, FAQItem } from '@/types/elevator';
import { ELEVATOR_MODELS, FAQS, COMPANY_INFO, QUICK_REPLIES, ACCESSORIES } from '@/constants/elevatorData';

export class ChatbotService {
  private static getGreeting(): string {
    const hour = new Date().getHours();
    if (hour < 12) return 'Good morning';
    if (hour < 18) return 'Good afternoon';
    return 'Good evening';
  }

  static generateWelcomeMessage(): ChatMessage {
    return {
      id: Date.now().toString(),
      type: 'bot',
      content: `${this.getGreeting()}! Welcome to GPlus Elevator üè¢\n\nI'm your virtual assistant, here to help you explore our next-generation elevator solutions. How can I assist you today?`,
      timestamp: new Date(),
      quickReplies: QUICK_REPLIES.initial,
    };
  }

  static processUserMessage(message: string): ChatMessage {
    const lowerMessage = message.toLowerCase().trim();
    let response = '';
    let quickReplies: string[] | undefined;

    // Product inquiries
    if (this.containsKeywords(lowerMessage, ['product', 'model', 'elevator', 'lift', 'view'])) {
      response = this.getProductOverview();
      quickReplies = QUICK_REPLIES.products;
    }
    // G+1 Models
    else if (this.containsKeywords(lowerMessage, ['g+1', 'g1', 'two floor', '2 floor'])) {
      response = this.getG1Models();
      quickReplies = ['Calculate Price', 'View G+2 Models', 'Back to Menu'];
    }
    // G+2 Models
    else if (this.containsKeywords(lowerMessage, ['g+2', 'g2', 'three floor', '3 floor', 'cfm', 'best seller'])) {
      response = this.getG2Models();
      quickReplies = ['Calculate Price', 'View G+1 Models', 'Back to Menu'];
    }
    // G+3 Models
    else if (this.containsKeywords(lowerMessage, ['g+3', 'g3', 'four floor', '4 floor'])) {
      response = this.getG3Models();
      quickReplies = ['Calculate Price', 'Request Quote', 'Back to Menu'];
    }
    // Pricing
    else if (this.containsKeywords(lowerMessage, ['price', 'cost', 'budget', 'calculate', 'how much'])) {
      response = this.getPricingInfo();
      quickReplies = ['View Products', 'Calculate Price', 'Back to Menu'];
    }
    // Installation
    else if (this.containsKeywords(lowerMessage, ['install', 'installation', 'setup', 'civil work'])) {
      response = this.getInstallationInfo();
      quickReplies = ['View Products', 'Request Quote', 'Back to Menu'];
    }
    // Maintenance
    else if (this.containsKeywords(lowerMessage, ['maintenance', 'amc', 'service', 'warranty'])) {
      response = this.getMaintenanceInfo();
      quickReplies = ['View AMC Packages', 'Request Quote', 'Back to Menu'];
    }
    // Safety
    else if (this.containsKeywords(lowerMessage, ['safe', 'safety', 'security', 'emergency'])) {
      response = this.getSafetyInfo();
      quickReplies = ['View Products', 'Request Quote', 'Back to Menu'];
    }
    // Customization
    else if (this.containsKeywords(lowerMessage, ['custom', 'design', 'color', 'cabin', 'accessory'])) {
      response = this.getCustomizationInfo();
      quickReplies = ['View Accessories', 'Request Quote', 'Back to Menu'];
    }
    // FAQs
    else if (this.containsKeywords(lowerMessage, ['faq', 'question', 'help', 'info'])) {
      response = this.getFAQOverview();
      quickReplies = ['Installation FAQs', 'Pricing FAQs', 'Safety FAQs', 'Back to Menu'];
    }
    // Contact
    else if (this.containsKeywords(lowerMessage, ['contact', 'phone', 'email', 'call', 'reach'])) {
      response = this.getContactInfo();
      quickReplies = ['Request Quote', 'View Products', 'Back to Menu'];
    }
    // Quote request
    else if (this.containsKeywords(lowerMessage, ['quote', 'quotation', 'estimate'])) {
      response = this.getQuoteInfo();
      quickReplies = ['Calculate Price', 'Contact Us', 'Back to Menu'];
    }
    // Compare models
    else if (this.containsKeywords(lowerMessage, ['compare', 'difference', 'classic vs ultra'])) {
      response = this.getModelComparison();
      quickReplies = ['View Products', 'Calculate Price', 'Back to Menu'];
    }
    // Back to menu
    else if (this.containsKeywords(lowerMessage, ['back', 'menu', 'main', 'start'])) {
      response = 'What would you like to know about GPlus Elevators?';
      quickReplies = QUICK_REPLIES.initial;
    }
    // Default response
    else {
      response = this.getDefaultResponse(lowerMessage);
      quickReplies = QUICK_REPLIES.initial;
    }

    return {
      id: Date.now().toString(),
      type: 'bot',
      content: response,
      timestamp: new Date(),
      quickReplies,
    };
  }

  private static containsKeywords(text: string, keywords: string[]): boolean {
    return keywords.some(keyword => text.includes(keyword));
  }

  private static getProductOverview(): string {
    return `üè¢ **GPlus Elevator Models**

We offer three main model categories:

**G+1 Series** (2 Landings)
‚Ä¢ Classic: ‚Çπ5,00,000 - ‚Çπ5,80,000
‚Ä¢ Ultra: ‚Çπ5,70,000 - ‚Çπ6,50,000

**G+2 Series** (3 Landings) ‚≠ê BEST SELLER
‚Ä¢ Classic: ‚Çπ5,70,000 - ‚Çπ6,80,000
‚Ä¢ Ultra: ‚Çπ7,20,000+
‚Ä¢ Our Customer's Favorite Model (CFM)!

**G+3 Series** (4 Landings)
‚Ä¢ Perfect for two-story homes with terrace
‚Ä¢ Custom pricing available

All models come in:
‚Ä¢ Sizes: 3x3, 3.6x3.6, 4x4 feet
‚Ä¢ Door Types: Manual or Auto
‚Ä¢ Enclosures: ACP or Glass (1-2 sides)

Which model interests you?`;
  }

  private static getG1Models(): string {
    const g1Models = ELEVATOR_MODELS.filter(m => m.type === 'G+1');
    return `**G+1 Models** (2 Landings)

Perfect for single-story homes or small buildings:

**Classic Series** (MS Cabin):
${g1Models.filter(m => m.category === 'Classic').map(m => 
  `‚Ä¢ ${m.name}\n  ‚Çπ${(m.basePrice / 100000).toFixed(2)} Lakhs\n  ${m.features.join(', ')}`
).join('\n\n')}

**Ultra Series** (SS304 Cabin):
${g1Models.filter(m => m.category === 'Ultra').map(m => 
  `‚Ä¢ ${m.name}\n  ‚Çπ${(m.basePrice / 100000).toFixed(2)} Lakhs\n  ${m.features.join(', ')}`
).join('\n\n')}

All prices include GST + Erection Cost`;
  }

  private static getG2Models(): string {
    return `**G+2 Models** ‚≠ê BEST SELLER (3 Landings)

Our Customer's Favorite Model (CFM)! Perfect for:
‚Ä¢ Two-story homes
‚Ä¢ Homes with terrace access
‚Ä¢ Maximum versatility

**Classic Series** (MS Cabin):
‚Ä¢ Manual Door + ACP: ‚Çπ5,70,000
‚Ä¢ Manual Door + Glass (1 Side): ‚Çπ6,40,000
‚Ä¢ Manual Door + Glass (2 Sides): ‚Çπ6,70,000

**Ultra Series** (SS304 Cabin):
‚Ä¢ Manual Door + Glass (1 Side): ‚Çπ7,20,000
‚Ä¢ Premium finishes and materials

**Why G+2 is Popular:**
‚úì Most versatile installation
‚úì Perfect size-to-value ratio
‚úì 3x3 ft fits most homes
‚úì Terrace or closed floor options

All prices include GST + Erection Cost`;
  }

  private static getG3Models(): string {
    return `**G+3 Models** (4 Landings)

Ideal for:
‚Ä¢ Two-story homes with terrace
‚Ä¢ Apartment-style individual houses
‚Ä¢ Families needing maximum accessibility

**Available in Both:**
‚Ä¢ Classic Series (MS Cabin)
‚Ä¢ Ultra Series (SS304 Cabin)

**Sizes:**
‚Ä¢ 3x3 feet (Premium compact)
‚Ä¢ 3.6x3.6 feet (Spacious)
‚Ä¢ 4x4 feet (Maximum comfort)
‚Ä¢ Customized sizes available

**Pricing:**
Custom quotes based on:
‚Ä¢ Chosen cabin type
‚Ä¢ Door type (Manual/Auto)
‚Ä¢ Enclosure type (ACP/Glass)
‚Ä¢ Additional accessories

Would you like a personalized quote?`;
  }

  private static getPricingInfo(): string {
    return `üí∞ **GPlus Elevator Pricing**

**Base Prices by Model:**

**G+1 Series:**
Classic: ‚Çπ5.00L - ‚Çπ5.80L
Ultra: ‚Çπ5.70L - ‚Çπ6.50L

**G+2 Series:** ‚≠ê
Classic: ‚Çπ5.70L - ‚Çπ6.80L
Ultra: ‚Çπ7.20L+

**Price Factors:**
‚Ä¢ Cabin Type (MS/SS/Gold)
‚Ä¢ Door Type (Manual/Auto)
‚Ä¢ Enclosure (ACP/Glass)
‚Ä¢ Size (3x3, 3.6x3.6, 4x4)
‚Ä¢ Accessories

**Payment Plan:**
‚Ä¢ 10% - Advance
‚Ä¢ 40% - At booking/fabrication
‚Ä¢ 45% - Material arrival
‚Ä¢ 5% - 80% completion

**What's Included:**
‚úì All materials & GST
‚úì Professional installation
‚úì 1-year warranty
‚úì Quality certification
‚úì Post-installation support

Use our calculator for exact pricing!`;
  }

  private static getInstallationInfo(): string {
    return `üîß **Installation Process**

**Space Requirements:**
‚Ä¢ Minimal: 3x3 feet (standard)
‚Ä¢ No extensive civil work needed
‚Ä¢ Core cutting for existing homes

**Timeline:**
Standard Models:
‚Ä¢ Fabrication: 10-15 working days
‚Ä¢ Installation: 5-10 working days

Customized Models:
‚Ä¢ Fabrication: 20-25 working days
‚Ä¢ Installation: 10-15 working days

**Pre-Installation (Customer's Part):**
1. Core cutting of roof
2. 3-Phase supply with MCCB
3. Bulkhead lighting
4. Completed plastering & tiling
5. For terrace: 12ft closed structure

**Our Installation Includes:**
‚úì Professional setup team
‚úì Quality assurance testing
‚úì Compliance with building codes
‚úì Complete commissioning
‚úì User training

**No License Required** for residential installations!

Ready to get started?`;
  }

  private static getMaintenanceInfo(): string {
    return `üõ†Ô∏è **Maintenance Services**

**Two AMC Options:**

**1. Basic AMC** (‚Çπ8,000-17,000/year)
‚Ä¢ Quarterly inspections (4/year)
‚Ä¢ Preventive maintenance
‚Ä¢ Cleaning & lubrication
‚Ä¢ Basic adjustments
‚Ä¢ Parts NOT included

**2. Comprehensive AMC** (‚Çπ30,000-55,000/year)
‚Ä¢ Everything in Basic AMC
‚Ä¢ All parts replacement included
‚Ä¢ Emergency repairs within 24-72 hrs
‚Ä¢ 24/7 support availability
‚Ä¢ No hidden costs

**What's Covered:**
‚úì Motor inspection
‚úì Control system checks
‚úì Cable & shaft examination
‚úì Safety system testing
‚úì Lubrication of moving parts
‚úì Oil level monitoring
‚úì Complete cleaning

**Emergency Service:**
‚Ä¢ Response: 6-8 hours
‚Ä¢ Available 24/7
‚Ä¢ Expert technicians

**Warranty:**
1 year comprehensive + 1 year extended

Protect your investment with professional maintenance!`;
  }

  private static getSafetyInfo(): string {
    return `üõ°Ô∏è **Safety Features**

**Built-in Safety Systems:**

**Emergency Protection:**
‚Ä¢ ARD (Automatic Rescue Device)
‚Ä¢ 8-hour battery backup
‚Ä¢ Emergency alarm button
‚Ä¢ Two-way video calling
‚Ä¢ Auto-location transmission

**Door Safety:**
‚Ä¢ Multi-beam light curtain
‚Ä¢ Auto-reverse on obstruction
‚Ä¢ Double safety locks
‚Ä¢ Emergency manual release
‚Ä¢ Entrapment sensors

**Mechanical Safety:**
‚Ä¢ Overspeed governors
‚Ä¢ Progressive safety gear
‚Ä¢ 150% rated load buffers
‚Ä¢ Advanced rope monitoring
‚Ä¢ Seismic detection system

**Fire Safety:**
‚Ä¢ Fire recall operation
‚Ä¢ Firefighter controls
‚Ä¢ Smoke detector integration
‚Ä¢ Emergency positioning

**Operational Safety:**
‚Ä¢ Precise leveling (3mm accuracy)
‚Ä¢ Automatic braking system
‚Ä¢ Power failure protection
‚Ä¢ Overload sensors

**Standards Compliance:**
‚úì Exceeds industry standards
‚úì Multiple redundant systems
‚úì Regular safety inspections
‚úì Certified components

Your safety is our priority!`;
  }

  private static getCustomizationInfo(): string {
    return `üé® **Customization Options**

**Cabin Materials:**
‚Ä¢ MS (Mild Steel) - Classic
‚Ä¢ SS304 (Stainless Steel) - Ultra
‚Ä¢ Gold Plated - Luxury

**Door Types:**
Manual:
‚Ä¢ Mesh sliding
‚Ä¢ MS/SS swing (half/full vision)

Auto:
‚Ä¢ MS auto sliding
‚Ä¢ SS auto sliding
‚Ä¢ Half/full vision glass

**Enclosures:**
‚Ä¢ ACP (Aluminum Composite)
‚Ä¢ 8mm Toughened Glass
‚Ä¢ 12mm Toughened Glass
‚Ä¢ Multi-color glass options

**Control Panels:**
‚Ä¢ Acrylic (Standard)
‚Ä¢ SS304 (Premium)
‚Ä¢ Gold/Rose Gold finish
‚Ä¢ Touch screen options

**Security Upgrades:**
‚Ä¢ RF & Password (‚Çπ10k-15k)
‚Ä¢ Fingerprint + Password (‚Çπ15k-20k)
‚Ä¢ Touch screen interface (‚Çπ3k-30k)
‚Ä¢ IoT Smart Controller (‚Çπ80k)

**Additional:**
‚Ä¢ Phase converter (‚Çπ20k)
‚Ä¢ Custom colors & finishes
‚Ä¢ LED lighting options
‚Ä¢ Floor announcing system

Create your perfect elevator!`;
  }

  private static getFAQOverview(): string {
    return `‚ùì **Frequently Asked Questions**

**Popular Questions:**

1Ô∏è‚É£ **Space Requirements**
Minimum 3x3 feet, no extensive civil work

2Ô∏è‚É£ **Installation Time**
1-3 weeks depending on customization

3Ô∏è‚É£ **Safety Standards**
Multiple redundant systems, exceeds codes

4Ô∏è‚É£ **Capacity**
3-5 people or 220 kg

5Ô∏è‚É£ **Power Outage**
ARD system with battery backup

6Ô∏è‚É£ **Maintenance**
AMC recommended, packages available

7Ô∏è‚É£ **Pricing**
‚Çπ5L - ‚Çπ7.2L based on specifications

8Ô∏è‚É£ **License**
Not required for residential

9Ô∏è‚É£ **Customization**
Extensive options available

üîü **Warranty**
1 year comprehensive + 1 year extended

**Categories:**
‚Ä¢ Installation FAQs
‚Ä¢ Pricing FAQs
‚Ä¢ Safety FAQs
‚Ä¢ Maintenance FAQs
‚Ä¢ Technical FAQs

Which topic would you like to explore?`;
  }

  private static getContactInfo(): string {
    return `üìû **Contact GPlus Elevator**

**Get in Touch:**

üì± **Phone:**
${COMPANY_INFO.phone.join('\n')}

üìß **Email:**
${COMPANY_INFO.email}

üåê **Website:**
${COMPANY_INFO.website}

**Office Hours:**
Monday - Saturday: 9:00 AM - 6:00 PM

**Quick Actions:**
‚Ä¢ Request detailed quotation
‚Ä¢ Schedule site visit
‚Ä¢ Product demonstration
‚Ä¢ Technical consultation
‚Ä¢ AMC enrollment

**Response Time:**
We typically respond within:
‚Ä¢ Phone: Immediate
‚Ä¢ Email: Within 24 hours
‚Ä¢ WhatsApp: Within 2 hours

**Service Coverage:**
Available for installations across India

How would you like to proceed?`;
  }

  private static getQuoteInfo(): string {
    return `üìã **Request a Quote**

To provide you with an accurate quotation, I need:

**Project Details:**
1. Building type (Residential/Commercial)
2. Number of floors (G+1/G+2/G+3)
3. Preferred size (3x3, 3.6x3.6, 4x4)
4. Model preference (Classic/Ultra)
5. Door type (Manual/Auto)
6. Enclosure type (ACP/Glass)

**Installation Site:**
7. Indoor or outdoor
8. New construction or existing building
9. Available space details

**Contact Information:**
10. Your name
11. Phone number
12. Email address
13. Location/Address

**Additional Requirements:**
‚Ä¢ Any special customizations
‚Ä¢ Preferred accessories
‚Ä¢ Timeline requirements

**Next Steps:**
1. Use our Price Calculator
2. Contact us directly for site visit
3. Get detailed quotation within 24 hrs

Ready to calculate your price?`;
  }

  private static getModelComparison(): string {
    return `‚öñÔ∏è **Classic vs Ultra Comparison**

**Classic Series:**
‚úì MS (Mild Steel) cabin
‚úì Powder-coated finish
‚úì Acrylic control panels
‚úì Cost-effective option
‚úì Durable & reliable
‚úì Multiple color choices
‚úì Perfect for budget-conscious

**Price Range:** ‚Çπ5.00L - ‚Çπ6.80L

**Ultra Series:**
‚úì SS304 stainless steel cabin
‚úì Premium rust-resistant
‚úì SS control panels
‚úì Sleek modern appearance
‚úì Enhanced durability
‚úì Reflective surfaces
‚úì Low maintenance

**Price Range:** ‚Çπ5.70L - ‚Çπ7.20L+

**Key Differences:**
| Feature | Classic | Ultra |
|---------|---------|-------|
| Cabin | MS | SS304 |
| COP/LOP | Acrylic | SS |
| Auto Door | MS | SS |
| Finish | Powder coat | Polished |
| Corrosion | Resistant | Highly resistant |
| Maintenance | Regular | Minimal |

**Both Include:**
‚Ä¢ Same safety features
‚Ä¢ Same motor & technology
‚Ä¢ Same warranty
‚Ä¢ Same installation process

Choose based on budget & aesthetic preference!`;
  }

  private static getDefaultResponse(message: string): string {
    // Try to find related FAQ
    const relatedFAQ = FAQS.find(faq => 
      faq.question.toLowerCase().includes(message) || 
      message.includes(faq.question.toLowerCase().split(' ').slice(0, 3).join(' '))
    );

    if (relatedFAQ) {
      return `**${relatedFAQ.question}**\n\n${relatedFAQ.answer}\n\nIs there anything else you would like to know?`;
    }

    return `I'm here to help with GPlus Elevators! I can assist you with:

‚Ä¢ Product information & models
‚Ä¢ Pricing & calculations
‚Ä¢ Installation process
‚Ä¢ Safety features
‚Ä¢ Maintenance services
‚Ä¢ Customization options
‚Ä¢ Quote requests
‚Ä¢ Contact information

What would you like to know?`;
  }
}